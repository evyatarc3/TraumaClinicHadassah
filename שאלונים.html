<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>מערכת שאלונים קליניים - מרפאת הטראומה הדסה</title>
<script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Heebo',sans-serif;background:#0f172a;min-height:100vh}
.app{max-width:1400px;margin:0 auto;background:#fff;min-height:100vh}

/* Login */
.login-bg{min-height:100vh;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,#0f172a 0%,#1e3a5f 50%,#0f172a 100%);padding:20px}
.login-card{background:#fff;border-radius:20px;padding:40px;max-width:450px;width:100%;box-shadow:0 25px 50px rgba(0,0,0,.25);text-align:center}
.login-logo{width:120px;height:120px;border-radius:12px;margin-bottom:16px;object-fit:contain}
.login-title{font-size:1.5em;color:#1e3a5f;font-weight:800;margin-bottom:4px}
.login-subtitle{color:#64748b;font-size:.9em;margin-bottom:24px}
.login-field{display:flex;flex-direction:column;gap:6px;margin-bottom:14px;text-align:right}
.login-field label{font-weight:600;color:#475569;font-size:.85em}
.login-field input{padding:12px;border:2px solid #e2e8f0;border-radius:8px;font-size:1em;font-family:inherit}
.login-field input:focus{outline:none;border-color:#3b82f6;box-shadow:0 0 0 3px rgba(59,130,246,.1)}
.login-btn{width:100%;padding:14px;background:linear-gradient(135deg,#1e3a5f,#3b82f6);color:#fff;border:none;border-radius:10px;font-size:1.05em;font-weight:700;cursor:pointer;font-family:inherit;margin-top:10px}
.login-btn:hover{opacity:.9}
.login-error{color:#dc2626;font-size:.85em;margin-top:10px}

/* Intake */
.intake-bg{min-height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;background:linear-gradient(135deg,#0f172a 0%,#1e3a5f 50%,#0f172a 100%);padding:20px}
.intake-card{background:#fff;border-radius:20px;padding:40px;max-width:700px;width:100%;box-shadow:0 25px 50px rgba(0,0,0,.25)}
.intake-header{text-align:center;margin-bottom:24px}
.intake-header h1{font-size:1.5em;color:#1e3a5f;margin-bottom:4px}
.intake-header p{color:#64748b;font-size:.9em}
.intake-section{background:#f8fafc;border-radius:12px;padding:20px;margin-bottom:16px}
.intake-section h3{font-size:1em;color:#1e3a5f;margin-bottom:14px;padding-bottom:8px;border-bottom:2px solid #3b82f6}
.intake-section.examiner h3{border-bottom-color:#10b981}
.intake-row{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:12px;margin-bottom:12px}
.intake-field{display:flex;flex-direction:column;gap:5px}
.intake-field label{font-weight:600;color:#475569;font-size:.82em}
.intake-field input,.intake-field select{padding:10px;border:2px solid #e2e8f0;border-radius:8px;font-size:.95em;font-family:inherit}
.intake-field input:focus,.intake-field select:focus{outline:none;border-color:#3b82f6}
.session-list{margin-top:12px}
.session-row{display:flex;gap:10px;align-items:center;margin-bottom:8px;padding:10px;background:#fff;border-radius:8px;border:1px solid #e2e8f0}
.add-session-btn{padding:10px 20px;background:#10b981;color:#fff;border:none;border-radius:8px;cursor:pointer;font-weight:600;font-family:inherit;margin-top:8px}
.start-btn{width:100%;padding:14px;background:linear-gradient(135deg,#1e3a5f,#3b82f6);color:#fff;border:none;border-radius:10px;font-size:1.1em;font-weight:700;cursor:pointer;font-family:inherit;margin-top:20px}
.remove-btn{background:#ef4444;color:#fff;border:none;border-radius:6px;padding:6px 12px;cursor:pointer;font-family:inherit;font-weight:600;font-size:.8em}

/* Header */
.hdr{background:linear-gradient(135deg,#1e3a5f,#0f172a);color:#fff;padding:16px 24px;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:10px}
.hdr-logo{width:50px;height:50px;border-radius:8px;object-fit:contain}
.hdr-info{flex:1;padding:0 16px}
.hdr-info h1{font-size:1.2em;margin-bottom:2px}
.hdr-info p{font-size:.8em;opacity:.85}
.hdr-badges{display:flex;gap:8px;flex-wrap:wrap}
.hdr-badge{background:rgba(255,255,255,.15);padding:4px 12px;border-radius:12px;font-size:.8em}
.logout-btn{background:rgba(255,255,255,.2);color:#fff;border:1px solid rgba(255,255,255,.3);padding:6px 14px;border-radius:8px;cursor:pointer;font-family:inherit;font-weight:600;font-size:.85em}

/* Main Menu Grid */
.main-menu{padding:40px 20px;background:#f1f5f9;min-height:70vh}
.menu-header{text-align:center;margin-bottom:40px}
.menu-header h2{color:#1e293b;font-size:1.8em;margin-bottom:10px}
.menu-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px;max-width:1200px;margin:0 auto}
.menu-card{background:#fff;border-radius:15px;padding:30px;text-align:center;cursor:pointer;transition:.3s;box-shadow:0 2px 8px rgba(0,0,0,.1);border:2px solid transparent}
.menu-card:hover{transform:translateY(-4px);box-shadow:0 8px 16px rgba(0,0,0,.15);border-color:#3b82f6}
.menu-card-icon{font-size:2.5em;margin-bottom:12px}
.menu-card-title{font-size:1.1em;font-weight:700;color:#1e293b;margin-bottom:8px}
.menu-card-desc{font-size:.85em;color:#64748b;line-height:1.4}
.menu-card.completed::after{content:"✓";position:absolute;top:10px;right:10px;background:#22c55e;color:#fff;border-radius:50%;width:30px;height:30px;display:flex;align-items:center;justify-content:center;font-weight:bold}
.menu-card{position:relative}

/* Tabs */
.main-tabs{display:flex;background:#0c4a6e;flex-wrap:wrap;overflow-x:auto}
.main-tab{padding:12px 16px;color:#94a3b8;cursor:pointer;border:none;background:none;font-size:.85em;font-weight:600;font-family:inherit;border-bottom:3px solid transparent;white-space:nowrap}
.main-tab:hover{background:#1e40af;color:#e2e8f0}
.main-tab.active{background:#1e3a5f;color:#fff;border-bottom-color:#3b82f6}
.main-tab.results-active{background:#065f46;color:#fff;border-bottom-color:#10b981}
.main-tab.diag-active{background:#831843;color:#fff;border-bottom-color:#ec4899}

/* Session selector */
.session-sel{display:flex;align-items:center;gap:10px;padding:10px 20px;background:#f1f5f9;border-bottom:1px solid #e2e8f0}
.session-sel label{font-weight:600;color:#475569;font-size:.85em}
.session-sel select{padding:6px 12px;border:2px solid #e2e8f0;border-radius:6px;font-family:inherit}
.add-session-from-menu{padding:6px 12px;background:#10b981;color:#fff;border:none;border-radius:6px;cursor:pointer;font-weight:600;font-family:inherit;font-size:.85em;margin-left:10px}

/* Content */
.content{padding:20px;background:#f1f5f9;min-height:70vh}
.section{background:#fff;border-radius:12px;padding:20px;margin-bottom:16px;box-shadow:0 1px 3px rgba(0,0,0,.08)}
.section-title{color:#1e293b;font-size:1.05em;font-weight:700;margin-bottom:14px;padding-bottom:8px;border-bottom:3px solid #3b82f6}

/* Progress */
.progress-wrap{background:#e2e8f0;height:8px;border-radius:4px;overflow:hidden;margin:10px 0}
.progress-fill{height:100%;border-radius:4px;transition:width .3s}
.progress-fill.low{background:#ef4444}
.progress-fill.mid{background:#f59e0b}
.progress-fill.high{background:#22c55e}
.progress-text{font-size:.82em;color:#64748b;display:flex;justify-content:space-between}

/* Question items */
.q-item{background:#fff;border:2px solid #e2e8f0;border-radius:10px;padding:16px;margin-bottom:12px;transition:.2s}
.q-item.answered{border-color:#86efac;background:#f0fdf4}
.q-num{display:inline-block;background:#3b82f6;color:#fff;padding:3px 10px;border-radius:12px;font-weight:700;font-size:.8em;margin-left:8px}
.q-text{font-size:.95em;font-weight:500;color:#1e293b;margin-bottom:10px;line-height:1.6}
.q-options{display:flex;flex-wrap:wrap;gap:6px}
.q-opt{padding:8px 14px;border-radius:8px;border:2px solid #e2e8f0;cursor:pointer;font-size:.82em;font-weight:500;font-family:inherit;background:#fff;transition:.2s}
.q-opt:hover{border-color:#3b82f6;background:#eff6ff}
.q-opt.selected{background:#7dd3c0;color:#fff;border-color:#7dd3c0}
.q-opt.s0.selected{background:#7dd3c0;border-color:#7dd3c0}
.q-opt.s1.selected{background:#7dd3c0;border-color:#7dd3c0}
.q-opt.s2.selected{background:#7dd3c0;border-color:#7dd3c0}
.q-opt.s3.selected{background:#7dd3c0;border-color:#7dd3c0}
.q-opt.s4.selected{background:#7dd3c0;border-color:#7dd3c0}
.q-opt.yes.selected{background:#7dd3c0;border-color:#7dd3c0}
.q-opt.no.selected{background:#7dd3c0;border-color:#7dd3c0}

/* BDI-II specific */
.bdi-item{background:#fff;border:2px solid #e2e8f0;border-radius:10px;padding:16px;margin-bottom:12px}
.bdi-item.answered{border-color:#86efac;background:#f0fdf4}
.bdi-options{display:grid;grid-template-columns:1fr;gap:8px;margin-top:10px}
.bdi-opt{padding:10px 14px;border-radius:8px;border:2px solid #e2e8f0;cursor:pointer;font-size:.85em;font-weight:500;font-family:inherit;background:#fff;transition:.2s;text-align:right}
.bdi-opt:hover{border-color:#3b82f6;background:#eff6ff}
.bdi-opt.selected{background:#7dd3c0;color:#fff;border-color:#7dd3c0}

/* Slider for DES */
.slider-row{display:flex;align-items:center;gap:12px}
.slider-row input[type=range]{flex:1;height:6px;accent-color:#3b82f6}
.slider-val{background:#3b82f6;color:#fff;padding:4px 10px;border-radius:6px;font-weight:700;font-size:.85em;min-width:50px;text-align:center}

/* LEC-5 */
.lec-grid{display:grid;grid-template-columns:repeat(6,1fr);gap:4px;font-size:.7em;text-align:center;margin-top:8px}
.lec-header{font-weight:700;color:#475569;padding:4px;background:#f1f5f9;border-radius:4px}
.lec-cell{padding:6px 2px}
.lec-cell input{cursor:pointer}

/* Results */
.result-card{background:#fff;border-radius:12px;padding:20px;margin-bottom:16px;border-right:4px solid #3b82f6;box-shadow:0 1px 3px rgba(0,0,0,.08)}
.result-card h3{color:#1e293b;font-size:1em;margin-bottom:12px}
.score-display{font-size:2.2em;font-weight:800;color:#1e293b;margin-bottom:4px}
.severity-badge{display:inline-block;padding:6px 16px;border-radius:8px;font-weight:700;font-size:.9em;margin-bottom:12px}
.sev-normal{background:#dcfce7;color:#166534}
.sev-mild{background:#fef9c3;color:#854d0e}
.sev-moderate{background:#fed7aa;color:#9a3412}
.sev-severe{background:#fecaca;color:#991b1b}
.sev-verysevere{background:#991b1b;color:#fff}
.subdomain{background:#f8fafc;border-radius:8px;padding:10px;margin-top:8px}
.subdomain-row{display:flex;justify-content:space-between;align-items:center;padding:6px 0;border-bottom:1px solid #e2e8f0}
.subdomain-row:last-child{border:none}
.subdomain-label{font-weight:600;color:#475569;font-size:.85em}
.subdomain-val{font-weight:700;color:#1e293b}
.bar-bg{flex:1;height:12px;background:#e2e8f0;border-radius:6px;margin:0 10px;overflow:hidden}
.bar-fill{height:100%;border-radius:6px}

/* Diagnosis */
.diag-search{padding:10px;border:2px solid #e2e8f0;border-radius:8px;width:100%;font-family:inherit;font-size:.95em;margin-bottom:16px}
.diag-search:focus{outline:none;border-color:#ec4899}
.diag-cat{margin-bottom:20px}
.diag-cat-title{font-weight:700;color:#831843;font-size:.95em;margin-bottom:10px;padding:8px 12px;background:#fdf2f8;border-radius:8px;border-right:4px solid #ec4899}
.diag-items{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:8px}
.diag-item{padding:10px;background:#fff;border:2px solid #e2e8f0;border-radius:8px;cursor:pointer;transition:.2s;font-size:.82em}
.diag-item:hover{border-color:#ec4899;background:#fdf2f8}
.diag-item.selected{border-color:#ec4899;background:#fce7f3}
.diag-code{font-weight:700;color:#831843;font-size:.9em}
.diag-desc{color:#475569}
.selected-diags{margin-top:16px;padding:16px;background:#fdf2f8;border-radius:12px}
.selected-diags h4{color:#831843;margin-bottom:10px}
.diag-tag{display:inline-flex;align-items:center;gap:6px;background:#ec4899;color:#fff;padding:6px 12px;border-radius:8px;margin:4px;font-size:.8em;font-weight:600}
.diag-tag button{background:none;border:none;color:#fff;cursor:pointer;font-size:1.1em;font-weight:700}

/* Criterion A */
.crit-a-text{width:100%;min-height:80px;padding:10px;border:2px solid #e2e8f0;border-radius:8px;font-family:inherit;font-size:.95em;resize:vertical}
.crit-a-text:focus{outline:none;border-color:#3b82f6}
.crit-a-options{display:flex;gap:10px;flex-wrap:wrap;margin-top:8px}

/* Columbia risk */
.risk-badge{padding:12px 20px;border-radius:12px;font-weight:700;font-size:1.1em;text-align:center;margin-top:16px}
.risk-low{background:#dcfce7;color:#166534}
.risk-moderate{background:#fef9c3;color:#854d0e}
.risk-high{background:#fecaca;color:#991b1b}

/* Export */
.export-btn{padding:12px 24px;background:linear-gradient(135deg,#3b82f6,#1d4ed8);color:#fff;border:none;border-radius:10px;cursor:pointer;font-weight:700;font-family:inherit;font-size:1em;margin:10px 5px}
.back-btn{padding:12px 24px;background:#64748b;color:#fff;border:none;border-radius:10px;cursor:pointer;font-weight:700;font-family:inherit;font-size:1em;margin:10px 5px}

@media(max-width:768px){
  .main-tabs{overflow-x:auto}
  .intake-row{grid-template-columns:1fr}
  .lec-grid{grid-template-columns:repeat(3,1fr);font-size:.65em}
  .q-options{flex-direction:column}
  .menu-grid{grid-template-columns:1fr}
}
@media print{
  .main-tabs,.hdr,.session-sel,.logout-btn,.back-btn,.export-btn{display:none!important}
  .content{padding:10px}
}
</style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">

const {useState, useEffect, useRef, useCallback} = React;

const LOGO = "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/2wBDAAUEBAQEAwUEBAQGBQUGCA0ICAcHCBALDAkNExAUExIQEhIUFx0ZFBYcFhISGiMaHB4fISEhFBkkJyQgJh0gISD/2wBDAQUGBggHCA8ICA8gFRIVICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICD/wAARCAEsAZADASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwD7LooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAK8U+LPxZ8R+A/F1ro+j2WmzwTWSXLNdRyMwYySLgbXUYwg7ete118qftH/APJStO/7BUf/AKOmr2smo06+KUKqurM8jN61SjhnOm7O6D/ho/xx/wBArQ/+/E3/AMdo/wCGj/HH/QK0P/vxN/8AHa8Zor7j+ysH/wA+0fGf2ni/+fjPZv8Aho/xx/0CtD/78Tf/AB2j/ho/xx/0CtD/AO/E3/x2vGaKP7Kwf/PtB/aeL/5+M9m/4aP8cf8AQK0P/vxN/wDHaP8Aho/xx/0CtD/78Tf/AByv
GEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA";

// ==================== BDI-II QUESTIONNAIRE ====================

const BDI2 = {
  name: "BDI-II",
  fullName: "שאלון בק לדיכאון - BDI-II",
  description: "אנא בחר את המשפט שהכי משקף את מצבך בשבועות האחרונים",
  items: [
    {q: "עצבות", opts: [
      {v:0, l:"אינני עצוב/ה"},
      {v:1, l:"אני עצוב/ה הרבה מהזמן"},
      {v:2, l:"אני עצוב/ה כל הזמן"},
      {v:3, l:"אני כל כך עצוב/ה או אומלל/ה שאני לא יכול/ה לסבול את זה"}
    ]},
    {q: "פסימיות", opts: [
      {v:0, l:"אינני מיואש/ת לגבי העתיד שלי"},
      {v:1, l:"אני מרגיש/ה מיואש/ת יותר מבעבר לגבי העתיד שלי"},
      {v:2, l:"אני לא מצפה שדברים יסתדרו בשבילי"},
      {v:3, l:"אני מרגיש/ה שהעתיד שלי חסר תקווה ושדברים רק ילכו ויחמירו"}
    ]},
    {q: "כישלונות בעבר", opts: [
      {v:0, l:"אינני מרגיש/ה ככישלון"},
      {v:1, l:"נכשלתי יותר ממה שהייתי צריך/ה"},
      {v:2, l:"כשאני מסתכל/ת לאחור, אני רואה הרבה כישלונות"},
      {v:3, l:"אני מרגיש/ה שאני כישלון מוחלט כאדם"}
    ]},
    {q: "אובדן הנאה", opts: [
      {v:0, l:"אני מקבל/ת הנאה כמו תמיד מדברים שאני נהנה מהם"},
      {v:1, l:"אני לא נהנה מדברים כמו פעם"},
      {v:2, l:"אני מקבל/ת מעט מאוד הנאה מדברים שפעם נהניתי מהם"},
      {v:3, l:"אני לא יכול/ה לקבל הנאה מדברים שפעם נהניתי מהם"}
    ]},
    {q: "רגשות אשמה", opts: [
      {v:0, l:"אינני מרגיש/ה אשם/ה במיוחד"},
      {v:1, l:"אני מרגיש/ה אשם/ה על הרבה דברים שעשיתי או שהייתי צריך/ה לעשות"},
      {v:2, l:"אני מרגיש/ה אשם/ה רוב הזמן"},
      {v:3, l:"אני מרגיש/ה אשם/ה כל הזמן"}
    ]},
    {q: "תחושת עונש", opts: [
      {v:0, l:"אינני מרגיש/ה שאני נענוש/ת"},
      {v:1, l:"אני מרגיש/ה שאולי אני נענוש/ת"},
      {v:2, l:"אני מצפה להיענש"},
      {v:3, l:"אני מרגיש/ה שאני נענוש/ת"}
    ]},
    {q: "חוסר שביעות רצון עצמית", opts: [
      {v:0, l:"אני מרגיש/ה כלפי עצמי כמו תמיד"},
      {v:1, l:"איבדתי ביטחון בעצמי"},
      {v:2, l:"אני מאוכזב/ת מעצמי"},
      {v:3, l:"אני לא אוהב/ת את עצמי"}
    ]},
    {q: "ביקורת עצמית", opts: [
      {v:0, l:"אינני מבקר/ת או מאשים/ה את עצמי יותר מהרגיל"},
      {v:1, l:"אני ביקורתי/ת כלפי עצמי יותר מבעבר"},
      {v:2, l:"אני מבקר/ת את עצמי על כל הפגמים שלי"},
      {v:3, l:"אני מאשים/ה את עצמי על כל דבר רע שקורה"}
    ]},
    {q: "מחשבות אובדניות", opts: [
      {v:0, l:"אין לי מחשבות על להרוג את עצמי"},
      {v:1, l:"יש לי מחשבות על להרוג את עצמי אבל לא הייתי מבצע/ת אותן"},
      {v:2, l:"הייתי רוצה להרוג את עצמי"},
      {v:3, l:"הייתי הורג/ת את עצמי אם הייתה לי הזדמנות"}
    ]},
    {q: "בכי", opts: [
      {v:0, l:"אינני בוכה יותר מבעבר"},
      {v:1, l:"אני בוכה יותר מבעבר"},
      {v:2, l:"אני בוכה על כל דבר קטן"},
      {v:3, l:"אני מרגיש/ה שאני רוצה לבכות אבל לא יכול/ה"}
    ]},
    {q: "חוסר מנוחה", opts: [
      {v:0, l:"אינני חסר/ת מנוחה או מתוח/ה יותר מהרגיל"},
      {v:1, l:"אני מרגיש/ה חסר/ת מנוחה או מתוח/ה יותר מהרגיל"},
      {v:2, l:"אני כל כך חסר/ת מנוחה שקשה לי לשבת בשקט"},
      {v:3, l:"אני כל כך חסר/ת מנוחה שאני חייב/ת לזוז או לעשות משהו כל הזמן"}
    ]},
    {q: "אובדן עניין", opts: [
      {v:0, l:"לא איבדתי עניין באנשים אחרים או בפעילויות"},
      {v:1, l:"אני פחות מתעניין/ת באנשים או בדברים מבעבר"},
      {v:2, l:"איבדתי את רוב העניין שלי באנשים אחרים או בדברים"},
      {v:3, l:"קשה לי להתעניין בכלל במשהו"}
    ]},
    {q: "חוסר החלטיות", opts: [
      {v:0, l:"אני מקבל/ת החלטות כמו תמיד"},
      {v:1, l:"קשה לי יותר מבעבר לקבל החלטות"},
      {v:2, l:"קשה לי הרבה יותר לקבל החלטות מבעבר"},
      {v:3, l:"יש לי קושי לקבל כל החלטה"}
    ]},
    {q: "חוסר ערך עצמי", opts: [
      {v:0, l:"אינני מרגיש/ה חסר/ת ערך"},
      {v:1, l:"אינני רואה את עצמי בעל/ת ערך ושימושי/ת כמו פעם"},
      {v:2, l:"אני מרגיש/ה חסר/ת ערך בהשוואה לאחרים"},
      {v:3, l:"אני מרגיש/ה חסר/ת ערך לחלוטין"}
    ]},
    {q: "אובדן אנרגיה", opts: [
      {v:0, l:"יש לי אנרגיה כמו תמיד"},
      {v:1, l:"יש לי פחות אנרגיה מבעבר"},
      {v:2, l:"אין לי מספיק אנרגיה לעשות הרבה"},
      {v:3, l:"אין לי מספיק אנרגיה לעשות שום דבר"}
    ]},
    {q: "שינויים בשינה", opts: [
      {v:0, l:"לא חל שינוי בהרגלי השינה שלי"},
      {v:1, l:"אני ישן/ה מעט יותר או מעט פחות מהרגיל"},
      {v:2, l:"אני ישן/ה הרבה יותר או הרבה פחות מהרגיל"},
      {v:3, l:"אני ישן/ה רוב שעות היום או מתעורר/ת מוקדם מדי"}
    ]},
    {q: "עצבנות", opts: [
      {v:0, l:"אינני עצבני/ת יותר מהרגיל"},
      {v:1, l:"אני עצבני/ת יותר מהרגיל"},
      {v:2, l:"אני עצבני/ת הרבה יותר מהרגיל"},
      {v:3, l:"אני עצבני/ת כל הזמן"}
    ]},
    {q: "שינויים בתיאבון", opts: [
      {v:0, l:"לא חל שינוי בתיאבון שלי"},
      {v:1, l:"התיאבון שלי מעט גדול או מעט קטן יותר מהרגיל"},
      {v:2, l:"התיאבון שלי הרבה יותר גדול או הרבה יותר קטן מהרגיל"},
      {v:3, l:"אין לי תיאבון כלל או יש לי תשוקה לאוכל כל הזמן"}
    ]},
    {q: "קושי בריכוז", opts: [
      {v:0, l:"אני יכול/ה להתרכז כמו תמיד"},
      {v:1, l:"אני לא יכול/ה להתרכז כמו תמיד"},
      {v:2, l:"קשה לי לשמור את דעתי על משהו לאורך זמן"},
      {v:3, l:"אני מוצא/ת שאני לא יכול/ה להתרכז בשום דבר"}
    ]},
    {q: "עייפות", opts: [
      {v:0, l:"אינני עייף/ה יותר מהרגיל"},
      {v:1, l:"אני מתעייף/ת מהר יותר מהרגיל"},
      {v:2, l:"אני עייף/ה מדי כדי לעשות הרבה דברים שנהגתי לעשות"},
      {v:3, l:"אני עייף/ה מדי כדי לעשות את רוב הדברים שנהגתי לעשות"}
    ]},
    {q: "אובדן עניין במין", opts: [
      {v:0, l:"לא שמתי לב לשינוי בעניין שלי במין"},
      {v:1, l:"אני פחות מתעניין/ת במין מבעבר"},
      {v:2, l:"אני הרבה פחות מתעניין/ת במין כעת"},
      {v:3, l:"איבדתי עניין במין לחלוטין"}
    ]}
  ],
  scoring: (answers) => {
    const sum = Object.values(answers).reduce((a,b) => a + (parseInt(b)||0), 0);
    let sev = "מינימלי", cls = "sev-normal";
    if(sum >= 29) { sev = "חמור"; cls = "sev-severe"; }
    else if(sum >= 20) { sev = "בינוני"; cls = "sev-moderate"; }
    else if(sum >= 14) { sev = "קל"; cls = "sev-mild"; }
    return {total: sum, max: 63, severity: sev, cls, subdomains: [{name:"דיכאון", score: sum, max: 63}]};
  }
};

// ==================== REST OF QUESTIONNAIRE DATA ====================

const PHQ9 = {
  name: "PHQ-9",
  fullName: "שאלון בריאות המטופל - PHQ-9",
  description: "שאלון לאיתור דיכאון",
  scale: [{v:0,l:"כלל לא"},{v:1,l:"מספר ימים"},{v:2,l:"יותר ממחצית הימים"},{v:3,l:"כמעט כל יום"}],
  items: [
    "עניין או הנאה מועטים בעשיית דברים",
    "תחושת דיכאון, מצב רוח ירוד או ייאוש",
    "קושי להירדם או לישון ברציפות, או שינה מרובה מדי",
    "תחושת עייפות או חוסר אנרגיה",
    "תיאבון מועט או אכילת יתר",
    "תחושה רעה כלפי עצמך - או תחושה שאתה כישלון או שאיכזבת את עצמך או את משפחתך",
    "קושי להתרכז בדברים, כגון קריאת עיתון או צפייה בטלוויזיה",
    "תנועה או דיבור אטיים מאוד שאנשים אחרים עשויים להבחין בכך. או ההפך - חוסר מנוחה או אי-שקט כה רבים שגרמו לך לנוע הרבה יותר מהרגיל",
    "מחשבות שעדיף לך למות, או מחשבות לפגוע בעצמך באיזשהו אופן"
  ],
  scoring: (answers) => {
    const sum = Object.values(answers).reduce((a,b) => a + (parseInt(b)||0), 0);
    let sev = "מינימלי", cls = "sev-normal";
    if(sum >= 20) { sev = "חמור"; cls = "sev-verysevere"; }
    else if(sum >= 15) { sev = "בינוני-חמור"; cls = "sev-severe"; }
    else if(sum >= 10) { sev = "בינוני"; cls = "sev-moderate"; }
    else if(sum >= 5) { sev = "קל"; cls = "sev-mild"; }
    return {total: sum, max: 27, severity: sev, cls, subdomains: [{name:"דיכאון", score: sum, max: 27}]};
  }
};

const GAD7 = {
  name: "GAD-7",
  fullName: "שאלון חרדה מוכללת - GAD-7",
  description: "שאלון לאיתור חרדה",
  scale: [{v:0,l:"כלל לא"},{v:1,l:"מספר ימים"},{v:2,l:"יותר ממחצית הימים"},{v:3,l:"כמעט כל יום"}],
  items: [
    "תחושת עצבנות, חרדה או מתיחות",
    "חוסר יכולת להפסיק לדאוג או לשלוט בדאגה",
    "דאגה מופרזת לגבי דברים שונים",
    "קושי להירגע",
    "חוסר מנוחה כה רב שקשה לשבת במקום",
    "להיות עצבני/ת או רגיז/ה בקלות",
    "תחושת פחד כאילו משהו נורא עומד לקרות"
  ],
  scoring: (answers) => {
    const sum = Object.values(answers).reduce((a,b) => a + (parseInt(b)||0), 0);
    let sev = "מינימלי", cls = "sev-normal";
    if(sum >= 15) { sev = "חמור"; cls = "sev-severe"; }
    else if(sum >= 10) { sev = "בינוני"; cls = "sev-moderate"; }
    else if(sum >= 5) { sev = "קל"; cls = "sev-mild"; }
    return {total: sum, max: 21, severity: sev, cls, subdomains: [{name:"חרדה", score: sum, max: 21}]};
  }
};

const DASS21 = {
  name: "DASS-21",
  fullName: "סולם דיכאון, חרדה ולחץ - DASS-21",
  description: "אנא ציין עד כמה כל אחד מהמשפטים הבאים התאים לך במהלך השבוע האחרון",
  scale: [{v:0,l:"לא התאים לי כלל"},{v:1,l:"התאים לי במידה מסוימת"},{v:2,l:"התאים לי במידה ניכרת"},{v:3,l:"התאים לי מאוד, רוב הזמן"}],
  items: [
    "מצאתי שקשה לי להירגע",
    "הייתי מודע/ת ליובש בפה שלי",
    "לא יכולתי לחוות שום רגש חיובי כלל",
    "חוויתי קושי בנשימה (למשל נשימה מהירה מדי, קוצר נשימה ללא מאמץ פיזי)",
    "מצאתי שקשה לי ליזום פעילות כלשהי",
    "הייתה לי נטייה להגיב יתר על המידה למצבים",
    "חוויתי רעד (למשל בידיים)",
    "הרגשתי שאני משתמש/ת באנרגיה עצבנית רבה",
    "דאגתי לגבי מצבים שבהם אני עלול/ה להיכנס לפאניקה ולעשות מעצמי צחוק",
    "הרגשתי שאין לי למה לצפות",
    "מצאתי את עצמי מתרגש/ת",
    "מצאתי שקשה לי להירגע",
    "הרגשתי עצוב/ה ומדוכא/ת",
    "לא סבלתי דבר שעמד בדרכי לסיים מה שעשיתי",
    "הרגשתי שאני קרוב/ה לפאניקה",
    "לא יכולתי להתלהב משום דבר",
    "הרגשתי שאני לא שווה הרבה כאדם",
    "הרגשתי שאני די רגיש/ת",
    "הייתי מודע/ת לפעולת הלב שלי בהיעדר מאמץ פיזי",
    "הרגשתי פחד ללא סיבה טובה",
    "הרגשתי שהחיים חסרי משמעות"
  ],
  scoring: (answers) => {
    const dIdx = [2,4,9,12,15,16,20];
    const aIdx = [1,3,6,8,14,18,19];
    const sIdx = [0,5,7,10,11,13,17];
    const sumOf = (idxs) => idxs.reduce((a,i) => a + (parseInt(answers[i])||0), 0) * 2;
    const d = sumOf(dIdx), a = sumOf(aIdx), s = sumOf(sIdx);
    const sevD = d <= 9 ? "תקין" : d <= 13 ? "קל" : d <= 20 ? "בינוני" : d <= 27 ? "חמור" : "חמור מאוד";
    const sevA = a <= 7 ? "תקין" : a <= 9 ? "קל" : a <= 14 ? "בינוני" : a <= 19 ? "חמור" : "חמור מאוד";
    const sevS = s <= 14 ? "תקין" : s <= 18 ? "קל" : s <= 25 ? "בינוני" : s <= 33 ? "חמור" : "חמור מאוד";
    const total = d + a + s;
    let cls = "sev-normal";
    if(d > 20 || a > 14 || s > 25) cls = "sev-severe";
    else if(d > 13 || a > 9 || s > 18) cls = "sev-moderate";
    else if(d > 9 || a > 7 || s > 14) cls = "sev-mild";
    return {total, max: 126, severity: `ד:${sevD} | ח:${sevA} | ל:${sevS}`, cls,
      subdomains: [{name:"דיכאון (Depression)", score: d, max: 42, severity: sevD},
                   {name:"חרדה (Anxiety)", score: a, max: 42, severity: sevA},
                   {name:"לחץ (Stress)", score: s, max: 42, severity: sevS}]};
  }
};

const PCL5 = {
  name: "PCL-5",
  fullName: "שאלון PTSD - PCL-5",
  description: "להלן רשימת בעיות שאנשים חווים לפעמים בתגובה לחוויה מלחיצה מאוד. אנא ציין עד כמה הוטרדת מכל בעיה בחודש האחרון",
  scale: [{v:0,l:"כלל לא"},{v:1,l:"מעט"},{v:2,l:"במידה בינונית"},{v:3,l:"במידה רבה"},{v:4,l:"במידה רבה מאוד"}],
  items: [
    "זיכרונות חוזרים, מטרידים ולא רצויים של החוויה המלחיצה",
    "חלומות חוזרים ומטרידים של החוויה המלחיצה",
    "פתאום הרגשת או פעלת כאילו החוויה המלחיצה קורה שוב (כאילו אתה שם מחדש)",
    "הרגשת מצוקה רבה כשמשהו הזכיר לך את החוויה המלחיצה",
    "תגובות גופניות חזקות כשמשהו הזכיר לך את החוויה המלחיצה (למשל דפיקות לב, קושי בנשימה, הזעה)",
    "הימנעות מזיכרונות, מחשבות או רגשות הקשורים לחוויה המלחיצה",
    "הימנעות מגירויים חיצוניים המזכירים את החוויה המלחיצה (אנשים, מקומות, שיחות, פעילויות, חפצים, מצבים)",
    "קושי לזכור חלקים חשובים מהחוויה המלחיצה",
    "אמונות שליליות חזקות לגבי עצמך, אחרים או העולם (למשל: אני רע, אי אפשר לסמוך על אף אחד, העולם מסוכן)",
    "האשמת עצמך או אחרים בחוויה המלחיצה או בתוצאותיה",
    "רגשות שליליים חזקים כמו פחד, אימה, כעס, אשמה או בושה",
    "אובדן עניין בפעילויות שנהגת ליהנות מהן",
    "תחושת ריחוק או ניתוק מאנשים אחרים",
    "קושי לחוות רגשות חיוביים (למשל חוסר יכולת להרגיש אושר, אהבה)",
    "התנהגות עצבנית, התפרצויות זעם, או התנהגות תוקפנית",
    "לקיחת סיכונים מיותרים או התנהגות שעלולה לפגוע בך",
    "תחושת עירנות יתר, דריכות או היות על המשמר",
    "תחושת בהלה או הפתעה בקלות",
    "קושי בריכוז",
    "בעיות שינה (למשל קושי להירדם, שינה לא רציפה, שינה לא שקטה)"
  ],
  scoring: (answers) => {
    const sum = Object.values(answers).reduce((a,b) => a + (parseInt(b)||0), 0);
    const sub = (idxs, name) => ({name, score: idxs.reduce((a,i) => a + (parseInt(answers[i])||0), 0), max: idxs.length * 4});
    let sev = "תקין", cls = "sev-normal";
    if(sum >= 33) { sev = "סביר PTSD"; cls = "sev-severe"; }
    else if(sum >= 31) { sev = "חשד ל-PTSD"; cls = "sev-moderate"; }
    else if(sum >= 20) { sev = "תסמינים בינוניים"; cls = "sev-mild"; }
    return {total: sum, max: 80, severity: sev, cls,
      subdomains: [
        sub([0,1,2,3,4], "חודרנות (Intrusion) B"),
        sub([5,6], "הימנעות (Avoidance) C"),
        sub([7,8,9,10,11,12,13], "שינויים שליליים בקוגניציה ומצב רוח D"),
        sub([14,15,16,17,18,19], "עוררות ותגובתיות (Arousal) E")
      ]};
  }
};

const OCIR = {
  name: "OCI-R",
  fullName: "שאלון אובססיבי-קומפולסיבי מתוקצר - OCI-R",
  description: "להלן רשימת חוויות שיש לאנשים רבים בחיי היומיום. אנא ציין עד כמה החוויה הבאה הטרידה או הציקה לך בחודש האחרון",
  scale: [{v:0,l:"כלל לא"},{v:1,l:"מעט"},{v:2,l:"במידה בינונית"},{v:3,l:"במידה רבה"},{v:4,l:"במידה רבה מאוד"}],
  items: [
    "אגרתי כל כך הרבה דברים שהם מפריעים לי",
    "אני בודק/ת דברים לעיתים קרובות יותר מהנדרש",
    "אני מתרגז/ת אם חפצים לא מסודרים כראוי",
    "אני מרגיש/ה צורך כפייתי לספור בזמן שאני עושה דברים",
    "אני מתקשה לגעת בחפץ כשאני יודע/ת שזרים נגעו בו",
    "אני מתקשה לשלוט במחשבות שלי",
    "אני אוסף/ת דברים שאני לא צריך/ה",
    "אני בודק/ת שוב ושוב דלתות, חלונות, מגירות וכו'",
    "אני מתרגז/ת אם אחרים משנים את הסדר שלי",
    "אני מרגיש/ה צורך לחזור על מספרים מסוימים",
    "לפעמים אני צריך/ה לשטוף את עצמי רק כי הרגשתי מזוהם/ת",
    "מחשבות לא נעימות חודרות לראש שלי בניגוד לרצוני",
    "אני מרגיש/ה צורך כפייתי לשמור דברים שלא אשתמש בהם",
    "אני חוזר/ת ובודק/ת שוב ושוב שהגז/הברז/האור כבוי",
    "אני צריך/ה שדברים יהיו מסודרים בצורה מסוימת",
    "אני מרגיש/ה שיש מספרים טובים ורעים",
    "אני שוטף/ת ידיים לעיתים קרובות יותר מהנדרש",
    "יש לי מחשבות לא נעימות באופן תדיר"
  ],
  scoring: (answers) => {
    const sum = Object.values(answers).reduce((a,b) => a + (parseInt(b)||0), 0);
    const sub = (idxs, name) => ({name, score: idxs.reduce((a,i) => a + (parseInt(answers[i])||0), 0), max: idxs.length * 4});
    let sev = "תקין", cls = "sev-normal";
    if(sum >= 21) { sev = "חשד ל-OCD"; cls = "sev-severe"; }
    else if(sum >= 14) { sev = "בינוני"; cls = "sev-moderate"; }
    return {total: sum, max: 72, severity: sev, cls,
      subdomains: [
        sub([0,6,12], "אגירה (Hoarding)"),
        sub([1,7,13], "בדיקה (Checking)"),
        sub([2,8,14], "סדר (Ordering)"),
        sub([3,9,15], "ספירה/חזרה (Counting)"),
        sub([4,10,16], "שטיפה (Washing)"),
        sub([5,11,17], "אובססיות (Obsessing)")
      ]};
  }
};

const COLUMBIA = {
  name: "C-SSRS",
  fullName: "סולם קולומביה לדירוג חומרת אובדנות",
  description: "השאלות הבאות עוסקות במחשבות והתנהגויות הקשורות לרצון למות או לפגוע בעצמך. אנא ענה בכנות.",
  items: [
    "האם איחלת שאתה מת או שתוכל ללכת לישון ולא להתעורר?",
    "האם חשבת בפועל על להרוג את עצמך?",
    "האם חשבת על איך תעשה זאת (תכננת שיטה)?",
    "האם הייתה לך כוונה כלשהי לפעול לפי מחשבות אלה, בניגוד לסתם לחשוב עליהן?",
    "האם התחלת לעבד או עיבדת פרטים של תוכנית להרוג את עצמך? האם יש לך כוונה לבצע תוכנית זו?",
    "האם אי פעם עשית משהו, התחלת לעשות משהו, או התכוננת לעשות משהו כדי לסיים את חייך?"
  ]
};

const CPSS = {
  name: "CPSS-SR-5",
  fullName: "סולם תסמיני PTSD לילדים ונוער - CPSS-SR-5",
  description: "להלן רשימת בעיות שילדים ובני נוער חווים לפעמים אחרי אירוע מפחיד או מלחיץ. חשוב על מה שקרה לך ואמור כמה פעמים קרתה כל בעיה בחודש האחרון.",
  scale: [{v:0,l:"כלל לא / רק פעם"},{v:1,l:"פעם בשבוע / מעט"},{v:2,l:"2-3 פעמים בשבוע"},{v:3,l:"4-5 פעמים בשבוע"},{v:4,l:"6+ פעמים בשבוע"}],
  items: [
    "היו לך זיכרונות מטרידים, מחשבות או דימויים של מה שקרה שעלו שוב ושוב",
    "היו לך חלומות רעים או סיוטים על מה שקרה",
    "פעלת או הרגשת כאילו מה שקרה קורה שוב",
    "הרגשת מצוקה, פחד או עצב כשמשהו הזכיר לך את מה שקרה",
    "היו לך תגובות גופניות (כמו דפיקות לב, כאב ראש, כאב בטן) כשמשהו הזכיר לך",
    "ניסית לא לחשוב על מה שקרה, לא לדבר על זה, או להדחיק רגשות קשורים",
    "נמנעת ממקומות, אנשים או פעילויות שהזכירו לך את מה שקרה",
    "לא יכולת לזכור חלק חשוב ממה שקרה",
    "היו לך מחשבות שליליות על עצמך או על העולם (כמו: אני רע, העולם מסוכן)",
    "האשמת את עצמך או אחרים במה שקרה או בתוצאותיו",
    "היו לך רגשות שליליים חזקים כמו פחד, כעס, אשמה או בושה",
    "איבדת עניין בפעילויות שנהגת ליהנות מהן",
    "הרגשת מרוחק/ת או מנותק/ת מאנשים אחרים",
    "היה לך קשה להרגיש רגשות חיוביים (כמו אושר או אהבה)",
    "היית עצבני/ת, היו לך התפרצויות כעס, או פעלת בתוקפנות",
    "עשית דברים מסוכנים שיכלו לפגוע בך",
    "היית ערני/ת מאוד, על המשמר, או חשדני/ת",
    "נבהלת בקלות, למשל כששמעת רעש חזק או כשמשהו הפתיע אותך",
    "היה לך קשה להתרכז, למשל לקרוא, לצפות בטלוויזיה או לשחק",
    "היו לך בעיות שינה - קשה להירדם, התעוררת באמצע הלילה, או קמת מוקדם מדי"
  ],
  funcItems: [
    "תפילות או פעילויות דתיות/רוחניות",
    "עבודות בית / חובות בבית",
    "יחסים עם חברים",
    "פעילויות מהנות או תחביבים",
    "עבודת בית ספר / לימודים",
    "יחסים עם המשפחה",
    "אושר כללי בחיים"
  ],
  scoring: (answers) => {
    const symptomAnswers = {};
    const funcAnswers = {};
    Object.entries(answers).forEach(([k,v]) => {
      if(k.startsWith("f_")) funcAnswers[k] = v;
      else symptomAnswers[k] = v;
    });
    const sum = Object.values(symptomAnswers).reduce((a,b) => a + (parseInt(b)||0), 0);
    const funcSum = Object.values(funcAnswers).filter(v => v === "1").length;
    const sub = (idxs, name) => ({name, score: idxs.reduce((a,i) => a + (parseInt(symptomAnswers[i])||0), 0), max: idxs.length * 4});
    let sev = "תקין", cls = "sev-normal";
    if(sum >= 31) { sev = "חשד ל-PTSD"; cls = "sev-severe"; }
    else if(sum >= 21) { sev = "מומלץ טיפול ממוקד טראומה"; cls = "sev-moderate"; }
    else if(sum >= 11) { sev = "תסמינים קלים-בינוניים"; cls = "sev-mild"; }
    return {total: sum, max: 80, severity: sev, cls,
      subdomains: [
        sub([0,1,2,3,4], "חודרנות (B)"),
        sub([5,6], "הימנעות (C)"),
        sub([7,8,9,10,11,12,13], "קוגניציה שלילית ומצב רוח (D)"),
        sub([14,15,16,17,18,19], "עוררות ותגובתיות (E)"),
        {name: "פגיעה תפקודית", score: funcSum, max: 7}
      ]};
  }
};

const DES = {
  name: "DES",
  fullName: "סולם חוויות דיסוציאטיביות - DES-II",
  description: "שאלון זה מכיל 28 שאלות על חוויות שאנשים חווים בחיי היומיום. סמן את אחוז הזמן שבו קורה לך כל דבר.",
  items: [
    "יש אנשים שנוהגים ברכב או באוטובוס ופתאום מבינים שהם לא זוכרים מה קרה במהלך כל הנסיעה או חלקה",
    "יש אנשים שמוצאים עצמם מקשיבים למישהו מדבר ופתאום מבינים שלא שמעו חלק ממה שנאמר או את כולו",
    "יש אנשים שמוצאים עצמם במקום מסוים ואין להם מושג איך הגיעו לשם",
    "יש אנשים שמגלים שהם לובשים בגדים שהם לא זוכרים שלבשו",
    "יש אנשים שמספרים להם שהם עושים או אומרים דברים שהם לא זוכרים שעשו או אמרו",
    "יש אנשים שמגלים בין חפציהם דברים שהם לא זוכרים שקנו",
    "יש אנשים שלפעמים מרגישים כאילו הם עומדים ליד עצמם וצופים בעצמם עושים משהו, כאילו הם מביטים באדם אחר",
    "יש אנשים שמספרים להם שלפעמים הם לא מזהים חברים או בני משפחה",
    "יש אנשים שמגלים שאין להם זיכרון לאירועים חשובים בחייהם (למשל חתונה, סיום תיכון)",
    "יש אנשים שחווים שאנשים אחרים, חפצים והעולם סביבם אינם אמיתיים",
    "יש אנשים שמביטים במראה ולא מזהים את עצמם",
    "יש אנשים שחווים שאנשים, חפצים ודברים סביבם אינם אמיתיים",
    "יש אנשים שמרגישים שהגוף שלהם לא מרגיש שייך להם",
    "יש אנשים שלפעמים זוכרים אירוע מהעבר בצורה כה חיה שמרגישים כאילו הוא חי וקורה שוב",
    "יש אנשים שלפעמים לא בטוחים אם דברים שהם זוכרים באמת קרו או שהם רק חלמו אותם",
    "יש אנשים שנמצאים במקום מוכר אבל מוצאים אותו מוזר ולא מוכר",
    "יש אנשים שכשהם צופים בטלוויזיה או בסרט הם נשאבים כל כך לסיפור שהם לא מודעים לדברים אחרים שקורים סביבם",
    "יש אנשים שנשאבים כל כך לדמיון או חלום בהקיץ שמרגישים כאילו זה באמת קורה להם",
    "יש אנשים שלפעמים מסוגלים להתעלם מכאב",
    "יש אנשים שלפעמים יושבים ומביטים לחלל ולא חושבים על כלום ולא מודעים לחלוף הזמן",
    "יש אנשים שלפעמים כשהם לבד הם מדברים בקול עם עצמם",
    "יש אנשים שמגלים שבמצב אחד הם פועלים בצורה כה שונה בהשוואה למצב אחר שהם מרגישים כאילו הם שני אנשים שונים",
    "יש אנשים שמגלים שבמצבים מסוימים הם מסוגלים לעשות דברים בקלות ובספונטניות מפתיעות שבדרך כלל יהיו קשים להם",
    "יש אנשים שלא יכולים לזכור אם הם עשו משהו או רק חשבו לעשות אותו",
    "יש אנשים שמגלים ראיות שעשו דברים שהם לא זוכרים שעשו",
    "יש אנשים שמוצאים כתבים, ציורים או רשימות בין חפציהם שהם בוודאות עשו אבל לא זוכרים שעשו",
    "יש אנשים ששומעים קולות בראשם שאומרים להם לעשות דברים או מגיבים על מה שהם עושים",
    "יש אנשים שלפעמים מרגישים כאילו הם מביטים בעולם דרך ערפל כך שאנשים וחפצים נראים רחוקים או לא ברורים"
  ],
  scoring: (answers) => {
    const vals = Object.values(answers).map(v => parseInt(v)||0);
    const avg = vals.length > 0 ? vals.reduce((a,b)=>a+b,0) / 28 : 0;
    const sub = (idxs, name) => {
      const s = idxs.map(i => parseInt(answers[i])||0);
      return {name, score: Math.round(s.reduce((a,b)=>a+b,0)/s.length), max: 100};
    };
    let sev = "תקין", cls = "sev-normal";
    if(avg >= 30) { sev = "דיסוציאציה קלינית משמעותית"; cls = "sev-severe"; }
    else if(avg >= 20) { sev = "דיסוציאציה בינונית"; cls = "sev-moderate"; }
    else if(avg >= 10) { sev = "דיסוציאציה קלה"; cls = "sev-mild"; }
    return {total: Math.round(avg*10)/10, max: 100, severity: sev, cls,
      subdomains: [
        sub([2,3,4,7,24,25], "שיכחון (Amnesia)"),
        sub([6,10,11,12,26,27], "דה-פרסונליזציה (Depersonalization)"),
        sub([1,13,14,16,17,19], "ספיגה (Absorption)")
      ]};
  }
};

const LEC5 = {
  name: "LEC-5",
  fullName: "רשימת החשיפה לטראומה - LEC-5",
  description: "להלן רשימת אירועים מסוכנים או מטרידים. בשביל כל אירוע, בחר כל השורות המתאימות לך.",
  categories: [
    {title: "מחשיפה ישירה (אתה הניסיון יובשת/ה/וויה את זה)",
      items: [
        "מלחמה, קרב צבאי / סכסך חמוש",
        "קנייה או ניסיון להנדסת או יצרנות",
        "סחיטה, התעמרות, צפיה בלחמים או אונס"
      ]},
    {title: "חשיפה עקיפה (אתה רואה זאת או שמע על זה)",
      items: [
        "לימוד שחבר / משפחה יש להם חוויה טראומטית",
        "צפיה בחבר / משפחה במצב מסוכן"
      ]}
  ]
};

const QUESTIONNAIRES = [BDI2, PHQ9, GAD7, DASS21, PCL5, OCIR, COLUMBIA, CPSS, DES, LEC5];

// ==================== COMPONENTS ====================

function StandardQuestion({item, idx, qnum, selectedValue, onAnswer, scale}) {
  return (
    <div className={`q-item ${selectedValue ? 'answered' : ''}`}>
      <div className="q-text">{item}<span className="q-num">{qnum+1}</span></div>
      <div className="q-options">
        {scale.map((opt, oi) => (
          <button key={oi} className={`q-opt s${Math.min(opt.v, 4)} ${selectedValue == opt.v ? 'selected' : ''}`}
            onClick={() => onAnswer(idx, selectedValue == opt.v ? null : opt.v)}>
            {opt.l}
          </button>
        ))}
      </div>
    </div>
  );
}

function BDI2Question({item, idx, selectedValue, onAnswer}) {
  return (
    <div className={`bdi-item ${selectedValue ? 'answered' : ''}`}>
      <div className="q-text">{item.q}<span className="q-num">{idx+1}</span></div>
      <div className="bdi-options">
        {item.opts.map((opt, oi) => (
          <button key={oi} className={`bdi-opt ${selectedValue == opt.v ? 'selected' : ''}`}
            onClick={() => onAnswer(idx, selectedValue == opt.v ? null : opt.v)}>
            {opt.l}
          </button>
        ))}
      </div>
    </div>
  );
}

function StandardQuestionnaire({q, answers, onAnswer, onBack}) {
  const ansCount = Object.values(answers).filter(v => v !== null && v !== undefined && v !== '').length;
  const allAnswered = ansCount === q.items.length;
  return (
    <div className="section">
      <div style={{marginBottom:'20px'}}>
        <button className="back-btn" onClick={onBack}>חזור לתפריט</button>
      </div>
      <h3 className="section-title">{q.fullName}</h3>
      <div style={{marginBottom:'20px'}}>{q.description}</div>
      <div className="progress-text">
        <span>ענו: {ansCount} / {q.items.length}</span>
        <div className="progress-wrap">
          <div className="progress-fill high" style={{width: (ansCount/q.items.length*100) + '%'}}></div>
        </div>
      </div>
      <div style={{marginTop:'20px'}}>
        {q.items.map((item, idx) => (
          <StandardQuestion key={idx} item={item} idx={idx} qnum={idx} 
            selectedValue={answers[idx]} onAnswer={onAnswer} scale={q.scale} />
        ))}
      </div>
      {allAnswered && (
        <div style={{marginTop:'30px', borderTop:'1px solid #e2e8f0', paddingTop:'20px'}}>
          <button className="export-btn" onClick={() => {
            const results = q.scoring(answers);
            exportQuestionnaire(q.name, answers, results);
          }}>הורד תוצאות</button>
          <button className="export-btn" onClick={() => alert('הוסף לתוצאות - בעדכון')}>הוסף לתוצאות</button>
        </div>
      )}
    </div>
  );
}

function BDI2Questionnaire({answers, onAnswer, onBack}) {
  const ansCount = Object.values(answers).filter(v => v !== null && v !== undefined && v !== '').length;
  const allAnswered = ansCount === BDI2.items.length;
  return (
    <div className="section">
      <div style={{marginBottom:'20px'}}>
        <button className="back-btn" onClick={onBack}>חזור לתפריט</button>
      </div>
      <h3 className="section-title">{BDI2.fullName}</h3>
      <div style={{marginBottom:'20px'}}>{BDI2.description}</div>
      <div className="progress-text">
        <span>ענו: {ansCount} / {BDI2.items.length}</span>
        <div className="progress-wrap">
          <div className="progress-fill high" style={{width: (ansCount/BDI2.items.length*100) + '%'}}></div>
        </div>
      </div>
      <div style={{marginTop:'20px'}}>
        {BDI2.items.map((item, idx) => (
          <BDI2Question key={idx} item={item} idx={idx} selectedValue={answers[idx]} onAnswer={onAnswer} />
        ))}
      </div>
      {allAnswered && (
        <div style={{marginTop:'30px', borderTop:'1px solid #e2e8f0', paddingTop:'20px'}}>
          <button className="export-btn" onClick={() => {
            const results = BDI2.scoring(answers);
            exportQuestionnaire(BDI2.name, answers, results);
          }}>הורד תוצאות</button>
          <button className="export-btn" onClick={() => alert('הוסף לתוצאות - בעדכון')}>הוסף לתוצאות</button>
        </div>
      )}
    </div>
  );
}

function ColumbiaQuestionnaire({answers, onAnswer, onBack}) {
  const allAnswered = Object.keys(answers).length === COLUMBIA.items.length;
  return (
    <div className="section">
      <div style={{marginBottom:'20px'}}>
        <button className="back-btn" onClick={onBack}>חזור לתפריט</button>
      </div>
      <h3 className="section-title">{COLUMBIA.fullName}</h3>
      <div style={{marginBottom:'20px'}}>{COLUMBIA.description}</div>
      {COLUMBIA.items.map((item, idx) => (
        <div key={idx} className={`q-item ${answers[idx] ? 'answered' : ''}`} style={{marginBottom:'20px'}}>
          <div className="q-text">{item}<span className="q-num">{idx+1}</span></div>
          <div className="q-options" style={{gap:'20px'}}>
            <button className={`q-opt yes ${answers[idx] === '1' ? 'selected' : ''}`}
              onClick={() => onAnswer(idx, answers[idx] === '1' ? null : '1')}>כן</button>
            <button className={`q-opt no ${answers[idx] === '0' ? 'selected' : ''}`}
              onClick={() => onAnswer(idx, answers[idx] === '0' ? null : '0')}>לא</button>
          </div>
        </div>
      ))}
      {allAnswered && (
        <div style={{marginTop:'30px', borderTop:'1px solid #e2e8f0', paddingTop:'20px'}}>
          <button className="export-btn" onClick={() => {
            exportQuestionnaire(COLUMBIA.name, answers, {});
          }}>הורד תוצאות</button>
          <button className="export-btn" onClick={() => alert('הוסף לתוצאות - בעדכון')}>הוסף לתוצאות</button>
        </div>
      )}
    </div>
  );
}

function ResultsView({data}) {
  return (
    <div className="section">
      <h3 className="section-title">תוצאות</h3>
      {!data || Object.keys(data).length === 0 ? (
        <p style={{color:'#64748b'}}>אין תוצאות להצגה. השלם שאלונים והוסף אותם לתוצאות.</p>
      ) : (
        Object.entries(data).map(([key, result]) => (
          <div key={key} className="result-card">
            <h3>{result.qname}</h3>
            {result.results && (
              <>
                <div className="score-display">{result.results.total}/{result.results.max}</div>
                <div className={`severity-badge ${result.results.cls}`}>{result.results.severity}</div>
                {result.results.subdomains && result.results.subdomains.map((sub, idx) => sub.score && sub.name && (
                  <div key={idx} className="subdomain">
                    <div className="subdomain-row">
                      <span className="subdomain-label">{sub.name}</span>
                      <span className="subdomain-val">{sub.score}/{sub.max}</span>
                    </div>
                    <div className="bar-bg">
                      <div className="bar-fill high" style={{width: (sub.score/sub.max*100) + '%'}}></div>
                    </div>
                  </div>
                ))}
              </>
            )}
          </div>
        ))
      )}
      {data && Object.keys(data).length > 0 && (
        <div style={{marginTop:'30px'}}>
          <button className="export-btn" onClick={() => exportSummaryExcel(data)}>ייצוא סיכום</button>
          <button className="export-btn" onClick={() => exportDetailedExcel(data)}>ייצוא מפורט</button>
        </div>
      )}
    </div>
  );
}

function DiagnosisView() {
  return (
    <div className="section">
      <h3 className="section-title">אבחנות F</h3>
      <p style={{color:'#64748b'}}>אבחנות F טרם הוזנו</p>
    </div>
  );
}

function MainMenu({onSelectQ, completedQ}) {
  const questionnaires = [
    {q: BDI2, icon: '📋'},
    {q: PHQ9, icon: '😔'},
    {q: GAD7, icon: '😰'},
    {q: DASS21, icon: '📊'},
    {q: PCL5, icon: '⚠️'},
    {q: OCIR, icon: '🔄'},
    {q: COLUMBIA, icon: '⚠️'},
    {q: CPSS, icon: '👶'},
    {q: DES, icon: '🌀'},
    {q: LEC5, icon: '📋'}
  ];
  return (
    <div className="main-menu">
      <div className="menu-header">
        <h2>בחר שאלון</h2>
      </div>
      <div className="menu-grid">
        {questionnaires.map((item, idx) => (
          <div key={idx} className={`menu-card ${completedQ[item.q.name] ? 'completed' : ''}`}
            onClick={() => onSelectQ(item.q.name)} style={{cursor:'pointer'}}>
            <div className="menu-card-icon">{item.icon}</div>
            <div className="menu-card-title">{item.q.name}</div>
            <div className="menu-card-desc">{item.q.fullName.substring(0, 50)}...</div>
          </div>
        ))}
      </div>
      <div style={{marginTop:'40px', textAlign:'center'}}>
        <div className="menu-card" onClick={() => alert('אבחנות F - בקרוב')}>
          <div className="menu-card-icon">🏥</div>
          <div className="menu-card-title">אבחנות F</div>
        </div>
      </div>
      <div style={{marginTop:'20px', textAlign:'center'}}>
        <div className="menu-card" onClick={() => alert('תוצאות - עבור לתוצאות')}>
          <div className="menu-card-icon">📊</div>
          <div className="menu-card-title">תוצאות</div>
        </div>
      </div>
    </div>
  );
}

// ==================== EXPORT FUNCTIONS ====================

function exportQuestionnaire(name, answers, results) {
  const text = `שאלון: ${name}\n\nתוצאות: ${results.total || 'לא נחשב'}/${results.max || ''}\nרמת חומרה: ${results.severity || 'N/A'}\n\nתשובות:\n` +
    Object.entries(answers).map(([k,v]) => `${k}: ${v}`).join('\n');
  const blob = new Blob([text], {type: 'text/plain'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `${name}_results.txt`;
  a.click();
}

function exportSummaryExcel(data) {
  const rows = [['שאלון', 'ציון כולל', 'מקסימום', 'רמת חומרה']];
  Object.entries(data).forEach(([k, result]) => {
    if(result.results) {
      rows.push([result.qname, result.results.total, result.results.max, result.results.severity]);
    }
  });
  const ws = XLSX.utils.aoa_to_sheet(rows);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, 'Summary');
  XLSX.writeFile(wb, 'summary.xlsx');
}

function exportDetailedExcel(data) {
  alert('ייצוא מפורט - בעדכון');
}

// ==================== MAIN APP ====================

function App() {
  const [isLoggedIn, setIsLoggedIn] = useState(false);
  const [intake, setIntake] = useState(null);
  const [currentSession, setCurrentSession] = useState(null);
  const [activeTab, setActiveTab] = useState('menu');
  const [selectedQ, setSelectedQ] = useState(null);
  const [answers, setAnswers] = useState({});
  const [results, setResults] = useState({});
  const [completedQ, setCompletedQ] = useState({});
  const [user, setUser] = useState('');
  const [pass, setPass] = useState('');
  const [error, setError] = useState('');

  if (!isLoggedIn) {
    return (
      <div className="login-bg">
        <div className="login-card">
          <img src={LOGO} className="login-logo" alt="לוגו" />
          <h1 className="login-title">מערכת שאלונים</h1>
          <p className="login-subtitle">מרפאת הטראומה הדסה</p>
          <div className="login-field">
            <label>שם משתמש</label>
            <input value={user} onChange={e => setUser(e.target.value)} />
          </div>
          <div className="login-field">
            <label>סיסמה</label>
            <input type="password" value={pass} onChange={e => setPass(e.target.value)} />
          </div>
          <button className="login-btn" onClick={() => {
            if(user && pass) { setIsLoggedIn(true); setError(''); }
            else setError('אנא הזן שם משתמש וסיסמה');
          }}>כניסה</button>
          {error && <div className="login-error">{error}</div>}
        </div>
      </div>
    );
  }

  if (!intake) {
    return (
      <div className="intake-bg">
        <div className="intake-card">
          <div className="intake-header">
            <h1>טופס רישום חדש</h1>
            <p>אנא מלא את הפרטים הבסיסיים</p>
          </div>
          <div className="intake-section">
            <h3>פרטי מטופל</h3>
            <div className="intake-row">
              <div className="intake-field">
                <label>שם</label>
                <input type="text" placeholder="שם מלא" id="patName" />
              </div>
              <div className="intake-field">
                <label>גיל</label>
                <input type="number" placeholder="גיל" id="patAge" />
              </div>
            </div>
            <div className="intake-row">
              <div className="intake-field">
                <label>מין</label>
                <select id="patGender">
                  <option>בחר</option>
                  <option>זכר</option>
                  <option>נקבה</option>
                  <option>אחר</option>
                </select>
              </div>
              <div className="intake-field">
                <label>אבחנה עיקרית</label>
                <input type="text" placeholder="אבחנה" id="patDiag" />
              </div>
            </div>
          </div>
          <div className="intake-section">
            <h3>פרטי בדיקה</h3>
            <div className="intake-row">
              <div className="intake-field">
                <label>תאריך</label>
                <input type="date" id="sessionDate" defaultValue={new Date().toISOString().split('T')[0]} />
              </div>
              <div className="intake-field">
                <label>סוג בדיקה</label>
                <select id="sessionType">
                  <option>בדיקה ראשונית</option>
                  <option>מעקב</option>
                </select>
              </div>
            </div>
          </div>
          <div className="intake-section examiner">
            <h3>פרטי בוחן</h3>
            <div className="intake-row">
              <div className="intake-field">
                <label>שם הבוחן</label>
                <input type="text" placeholder="שם הבוחן" id="examName" />
              </div>
              <div className="intake-field">
                <label>תעודת זיהוי</label>
                <input type="text" placeholder="ת.ז." id="examID" />
              </div>
            </div>
          </div>
          <button className="start-btn" onClick={() => {
            const patName = document.getElementById('patName').value;
            const patAge = document.getElementById('patAge').value;
            if(patName && patAge) {
              setIntake({
                name: patName, age: patAge, gender: document.getElementById('patGender').value,
                diag: document.getElementById('patDiag').value,
                sessionDate: document.getElementById('sessionDate').value,
                sessionType: document.getElementById('sessionType').value,
                examName: document.getElementById('examName').value,
                examID: document.getElementById('examID').value
              });
              setCurrentSession({date: document.getElementById('sessionDate').value});
            } else {
              alert('אנא מלא שם וגיל');
            }
          }}>התחל</button>
        </div>
      </div>
    );
  }

  const qName = selectedQ;
  const q = QUESTIONNAIRES.find(x => x.name === qName);

  return (
    <div className="app">
      <div className="hdr">
        <img src={LOGO} className="hdr-logo" alt="לוגו" />
        <div className="hdr-info">
          <h1>{intake.name}</h1>
          <p>{currentSession?.date}</p>
        </div>
        <div className="hdr-badges">
          <span className="hdr-badge">בן/בת {intake.age}</span>
          <span className="hdr-badge">{intake.gender}</span>
        </div>
        <button className="logout-btn" onClick={() => {setIsLoggedIn(false); setIntake(null); setSelectedQ(null); setAnswers({});}}>חروج</button>
      </div>

      {!qName ? (
        <>
          <div className="main-tabs">
            <button className={`main-tab ${activeTab === 'menu' ? 'active' : ''}`} onClick={() => {setActiveTab('menu'); setAnswers({}}}>תפריט</button>
            <button className={`main-tab results-active ${activeTab === 'results' ? 'active' : ''}`} onClick={() => setActiveTab('results')}>תוצאות</button>
            <button className={`main-tab diag-active ${activeTab === 'diag-active' ? 'active' : ''}`} onClick={() => setActiveTab('diag')}>אבחנות F</button>
          </div>
          <div className="session-sel">
            <label>פגישה:</label>
            <select value={currentSession?.date || ''} onChange={e => setCurrentSession({date: e.target.value})}>
              <option value={intake.sessionDate}>{intake.sessionDate}</option>
            </select>
            <button className="add-session-from-menu" onClick={() => {
              const newDate = prompt('הזן תאריך חדש (YYYY-MM-DD):');
              if(newDate) setCurrentSession({date: newDate});
            }}>הוסף פגישה</button>
          </div>
          <div className="content">
            {activeTab === 'menu' && <MainMenu onSelectQ={setSelectedQ} completedQ={completedQ} />}
            {activeTab === 'results' && <ResultsView data={results} />}
            {activeTab === 'diag' && <DiagnosisView />}
          </div>
        </>
      ) : (
        <div className="content">
          {q?.name === 'BDI-II' ? (
            <BDI2Questionnaire answers={answers} onAnswer={(idx, val) => {
              const newAns = {...answers}; newAns[idx] = val; setAnswers(newAns);
              if(val !== null && Object.values(newAns).filter(v => v !== null && v !== undefined && v !== '').length === BDI2.items.length) {
                setCompletedQ({...completedQ, [BDI2.name]: true});
              }
            }} onBack={() => setSelectedQ(null)} />
          ) : q?.name === 'C-SSRS' ? (
            <ColumbiaQuestionnaire answers={answers} onAnswer={(idx, val) => {
              const newAns = {...answers}; newAns[idx] = val; setAnswers(newAns);
            }} onBack={() => setSelectedQ(null)} />
          ) : (
            <StandardQuestionnaire q={q} answers={answers} onAnswer={(idx, val) => {
              const newAns = {...answers}; newAns[idx] = val; setAnswers(newAns);
              if(val !== null && Object.values(newAns).filter(v => v !== null && v !== undefined && v !== '').length === q.items.length) {
                setCompletedQ({...completedQ, [q.name]: true});
              }
            }} onBack={() => setSelectedQ(null)} />
          )}
        </div>
      )}
    </div>
  );
}

ReactDOM.render(<App />, document.getElementById('root'));
</script>
</body>
</html>
